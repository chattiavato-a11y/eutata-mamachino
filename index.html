<!doctype html>
<html lang="en" data-theme="dark">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Chat · Local-first with WebGPU fallback</title>
<style>
  :root{ --bg:#0b0c10; --card:#121319; --ink:#e6e6e6; --muted:#a9b0b8; --accent:#6ad1ff; --ring:rgba(106,209,255,.35); }
  [data-theme="light"]{ --bg:#ffffff; --card:#f5f7fb; --ink:#1f2430; --muted:#536070; --accent:#0077ff; --ring:rgba(0,119,255,.25); }
  body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial;}
  .wrap{max-width:900px;margin:0 auto;padding:20px}
  header{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:10px;flex-wrap:wrap}
  .toggles{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  button,select{background:var(--card);color:var(--ink);border:1px solid #242634;border-radius:10px;padding:8px 12px}
  button:hover{outline:2px solid var(--ring)}
  .pill{display:inline-flex;gap:6px;align-items:center;padding:6px 10px;border-radius:999px;border:1px solid #242634;background:var(--card)}
  .chat{background:var(--card);border:1px solid #242634;border-radius:14px;padding:14px;height:60vh;overflow:auto}
  .msg{margin:8px 0;padding:10px 12px;border-radius:10px;white-space:pre-wrap}
  .me{background:rgba(106,209,255,.08);border:1px solid rgba(106,209,255,.25)}
  .ai{background:rgba(255,255,255,.03);border:1px solid #2a2d3b}
  .bar{display:flex;gap:8px;margin-top:10px}
  .bar textarea{flex:1;min-height:44px;max-height:160px;resize:vertical;background:var(--card);color:var(--ink);border:1px solid #242634;border-radius:10px;padding:10px}
  .muted{color:var(--muted);font-size:12px}
  .bad{color:#ff7b7b}
  .visually-hidden{position:absolute !important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
</style>

<body>
  <div class="wrap">
    <header>
      <div>
        <h1 data-i18n="header.title">OPS Chat Interface</h1>
      </div>
      <div class="toggles" role="group" aria-label="Display and language settings">
        <label for="themeBtn" class="muted" data-i18n="controls.themeLabel">Theme</label>
        <button id="themeBtn" type="button" data-action="toggle-theme" aria-pressed="true">Dark</button>
        <label for="langSel" class="muted" data-i18n="controls.languageLabel">Lang</label>
        <select id="langSel" aria-label="Language selector" data-action="select-language">
          <option value="en" data-i18n="language.option.en" selected>English</option>
          <option value="es" data-i18n="language.option.es">Español</option>
        </select>
      </div>
    </header>

    <main>
      <section aria-labelledby="chat-title">
        <div class="policy-card">
          <h2 id="chat-title">Chattia</h2>
          <form id="chatForm" novalidate>
            <div id="chat" class="chat" role="log" aria-live="polite"></div>
            <div class="bar">
              <label class="visually-hidden" for="input" data-i18n="controls.inputLabel">Chat message</label>
              <textarea id="input" data-i18n-attrs="placeholder:controls.placeholder,aria-label:controls.inputLabel" placeholder="Type a message…" aria-label="Message input"></textarea>
              <button id="send" type="submit" data-i18n="controls.send">Send</button>
            </div>
            <div class="muted" id="status" role="status" aria-live="polite">Ready.</div>
            <div class="bad" id="warn" role="alert"></div>
          </form>
        </div>
      </section>

    </main>

    <footer>
      <nav class="footer-links" aria-label="Compliance policies">
        <details>
          <summary>Cookie Consent</summary>
          <p>By using this tool, you agree that essential cookies collect operational details needed for the service. We study aggregated chatbot interaction behavior strictly to improve responses, and no PII or other data beyond chat content is gathered.</p>
        </details>
        <details>
          <summary>Terms &amp; Conditions</summary>
          <p>Use of this chat interface signifies agreement to comply with all acceptable use policies, maintain confidentiality of outputs, and avoid transmitting malicious or unauthorized data.</p>
          <p>Services are provided “as is” with no warranty; uptime targets follow PCI DSS operational resilience guidelines, and jurisdiction is governed by applicable local laws.</p>
        </details>
        <details>
          <summary>Trademark &amp; Copyright</summary>
          <p>&copy; <span id="copyrightYear"></span> ShieldOps. All rights reserved. ShieldOps, the Shield logo, and related marks are trademarks of their respective owners.</p>
          <p>Unauthorized reproduction, distribution, or modification is prohibited without prior written consent. Third-party marks referenced are property of their owners.</p>
        </details>
      </nav>
    </footer>
  </div>

  <div id="cookieBanner" class="cookie-banner hidden" role="dialog" aria-live="polite" aria-modal="false" aria-label="Cookie consent">
    <div>
      <strong>L1 → L5 (extractive) → WebLLM/WebGPU (low confidence only) → L2/L3/L7</strong><br>
      <span class="muted">Local-first; external only if allowed. Budgeted 75k–100k tokens per session.</span>
    </div>
    <div class="toggles">
      <button id="cookieThemeBtn" type="button" data-action="toggle-theme" aria-pressed="true">Dark</button>
      <label class="muted" for="cookieLangSel" data-i18n="controls.languageLabel">Lang</label>
      <select id="cookieLangSel" data-action="select-language">
        <option value="en" data-i18n="language.option.en" selected>English</option>
        <option value="es" data-i18n="language.option.es">Español</option>
      </select>
      <div class="pill" title="Routing Mode">
        <label class="muted" for="modeSel" data-i18n="controls.modeLabel">Mode</label>
        <select id="modeSel" data-action="select-mode">
          <option value="hybrid" data-i18n="controls.mode.hybrid" selected>Hybrid</option>
          <option value="local" data-i18n="controls.mode.local">Local only</option>
          <option value="external" data-i18n="controls.mode.external">External only</option>
        </select>
      </div>
      <div class="pill"><span class="muted" data-i18n="controls.tokensLabel">Session tokens:</span>&nbsp;<span id="budgetHint">0</span></div>
    </div>
    <div class="cookie-actions">
      <button id="declineCookies" type="button" data-i18n="cookie.remind">Remind me later</button>
      <button id="acceptCookies" type="button" data-i18n="cookie.accept">Agree &amp; continue</button>
    </div>
    <div class="muted" id="cookieStatus" role="status" aria-live="polite"></div>
    <div class="bad" id="cookieWarn" role="alert"></div>
  </div>

  <script src="./shield.js" defer></script>
  <script src="./i18n.js" defer></script>
  <script type="module" src="./main.js"></script>
</body>
</html>
